#!/usr/local/bin/perl -w

# ident "@(#) $Header$"
# ident "@(#)        $Name$"

package Bedrock::Modules::TimeNow;

use Tie::Hash;
@ISA = qw(Tie::StdHash);

my @__mon = qw (jan feb mar apr may jun jul aug sep oct nov dec);
my @__day = qw (sunday monday tuesday wednesday thursday friday saturday);
my @__dy  = qw (sun mon tue wed thu fri sat);

#
# Local time functions
#
sub SS		{sprintf "%02d", $_[0]}
sub MI		{sprintf "%02d", $_[1]}
sub HH24	{sprintf "%02d", $_[2]}
sub HH		{my $hour = $_[2]; sprintf "%02d", $hour > 12 ? $hour - 12 : $hour}
sub D		{$_[6]}
sub DD		{sprintf "%02d", $_[3]}
sub DDD		{sprintf "%03d", $_[7] + 1}
sub DAY		{uc($__day[$_[6]])}
sub day		{lc($__day[$_[6]])}
sub Day		{ucfirst($__day[$_[6]])}
sub DY		{uc($__dy[$_[6]])}
sub dy		{lc($__dy[$_[6]])}
sub Dy		{ucfirst($__dy[$_[6]])}
sub YY		{my $year = $_[5]; sprintf "%02d", $year >= 100 ? $year - 100 : $year}
sub YYYY	{sprintf "%04d", $_[5] + 1900}
sub MM		{sprintf "%02d", $_[4] + 1}
sub MON		{uc($__mon[$_[4]])}
sub mon		{lc($__mon[$_[4]])}
sub Mon		{ucfirst($__mon[$_[4]])}

#
# GM time functions
#
sub rfc1123
{
    my ( $sec, $min, $hour, $mday, $mon, $year, $wday, $yday, $isdst, $time) = @_;
    sprintf( "%s, %02d %s %d %02d:%02d:%02d GMT",
	     ucfirst( $__dy[$wday] ),
	     $mday,
	     ucfirst( $__mon[$mon] ),
	     $year + 1900,
	     $hour, $min, $sec);
}

sub rfc850
{
    my ( $sec, $min, $hour, $mday, $mon, $year, $wday, $yday, $isdst, $time) = @_;
    sprintf( "%s, %02d-%s-%d %02d:%02d:%02d GMT",
	     ucfirst( $__day[$wday] ),
	     $mday,
	     ucfirst( $__mon[$mon] ),
	     $year + 1900,
	     $hour, $min, $sec);
}

sub FETCH
{
    my $self = shift;
    my $key = shift;

    my %localtime = ('SS'	=> \&SS,
		     'MI'	=> \&MI,
		     'HH24'	=> \&HH24,
		     'HH12'	=> \&HH,
		     'HH'	=> \&HH,
		     'D'	=> \&D,
		     'DD'	=> \&DD,
		     'DDD'	=> \&DDD,
		     'DAY'	=> \&DAY,
		     'day'	=> \&day,
		     'Day'	=> \&Day,
		     'DY'	=> \&DY,
		     'dy'	=> \&dy,
		     'Dy'	=> \&Dy,
		     'MM'	=> \&MM,
		     'MON'	=> \&MON,
		     'mon'	=> \&mon,
		     'Mon'	=> \&Mon,
		     'YY'	=> \&YY,
		     'YYYY'	=> \&YYYY);

    my %gmtime = ('RFC1123'	=> \&rfc1123,
		  'RFC850'	=> \&rfc850);

    if ( exists $localtime{$key} ) { return $localtime{$key}->(localtime, time); }
    elsif ( exists $gmtime{$key} ) { return $gmtime{$key}->(gmtime, time); }
    undef;
}

1;

#
# Name of Release: $Name$
# $Log$
# Revision 1.1  2000/05/17 14:29:42  sridhar
# Adding Loadable module TimeNow -- support for current date and time in
# Bedrock pages
#
#


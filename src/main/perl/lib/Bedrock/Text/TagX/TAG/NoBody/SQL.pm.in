#!/usr/bin/perl -w

# ident "@(#) $Header$"
# ident "@(#)        $Name$"

package TagX::TAG::NoBody::SQL;

use strict;
use vars qw (@ISA);
use Getopt::Long;
use DBI;

use TagX::TAG::NoBody;
@ISA = qw (TagX::TAG::NoBody);

sub finalize
{
    my ($self, $tx, @context) = @_;

    local (@ARGV) = @{$self->{'argv'}};
    my %valid = ('dbname'	=> '_anonymous_');
    &GetOptions(\%valid,
		'dbname=s',
		'arg=s@',
		'statement=s',
		'bind=s@');
    return unless exists $valid{'statement'};
    my $name = $valid{'dbname'};
    return unless exists $tx->{'DB'}->{$name};

    my $dbh = $tx->{'DB'}->{$name};
    my $statement = $valid{'statement'};
    my @args = @{$valid{'arg'}} if exists $valid{'arg'};
    my @bind = @{$valid{'bind'}} if exists $valid{'bind'};

    my @argvals = map { $self->resolve_name ( $_, @context ) } @args;
    my @bindvals = map { $self->resolve_name ( $_, @context ) } @bind;

    $statement = sprintf ($statement, @argvals) if @args > 0;
    my $sth = $dbh->prepare ( $statement );
    return unless $sth;
    $sth->execute (@bindvals);
}

#
# Name of Release: $Name$
# $Log$
# Revision 1.1  2000/02/08 15:24:59  sridhar
# Added TagX
#
#

1;

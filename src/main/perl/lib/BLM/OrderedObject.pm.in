#!/usr/local/bin/perl -w

# ident "@(#) $Header$"
# ident "@(#)        $Name$"

#
#    This file is a part of Bedrock, a server-side web scripting tool.
#    Check out http://www.openbedrock.net
#    Copyright (C) 2001, Charles Jones, LLC.
#
#    This program is free software; you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation; either version 2 of the License, or
#    any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program; if not, write to the Free Software
#    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
#

package BLM::OrderedObject;

use strict;

BEGIN
{
    use Exporter ();
    use vars	qw ($VERSION @ISA);
    $VERSION	= 1.02;
}

use TagX::Log 1.01;
use Bedrock::Hash 1.01;

@ISA = qw(Bedrock::Hash);

sub TIEHASH
{
    my $class = shift;
    my $self = bless {}, $class;
    $self->{'vars'} = [];

    for (my $i = 0 ; $i < @_ ; $i++ ) {
	my $key = $_[$i++];
	if ( ref( $key ) ) {
	    if ( &UNIVERSAL::isa($key, 'ARRAY') ) {
		for ( my $j = 0 ; $j < @{$key} ; $j++ ) {
		    my $k = $key->[$j++];
		    die "Key (item $j of item $i) must be a scalar.\n"
			if ref($k);
		    push @{$self->{'vars'}}, $k, $key->[$j];
		}
	    } elsif ( &UNIVERSAL::isa($key, 'HASH' ) ) {
		for my $k (keys %{$key}) {
		    push @{$self->{'vars'}}, $k, $key->{$k};
		}
	    } else {
		die "Key `$key' has invalid type: must be an object or array.\n";
	    }
	} else {
	    push @{$self->{'vars'}}, $key, $_[$i];
	}
    }

    $self;
}

sub FETCH
{
    my ($self, $key) = @_;
    my %vars = @{$self->{'vars'}};
    $vars{$key};
}

sub STORE
{
    my $self = shift;
    my ($key, $value) = @_;
    my @vars = @{$self->{'vars'}};
    for (my $i = 0; $i < @vars ; $i++ ) {
	next unless $vars[$i++] eq $key;
	$self->{'vars'}->[$i] = $value;
	return;
    }
    push @{$self->{'vars'}}, $key, $value;
}

sub FIRSTKEY
{
    my $self = shift;
    my $index = $self->{'index'} = 0;
    wantarray ?	@{$self->{'vars'}}[$index,$index+1] : $self->{'vars'}->[$index];
}

sub NEXTKEY
{
    my $self = shift;
    $self->{'index'} += 2;
    my $index = $self->{'index'};
    wantarray ? @{$self->{'vars'}}[$index,$index+1] : $self->{'vars'}->[$index];
}

sub EXISTS
{
    my ($self, $key) = @_;
    my %vars = %{$self->{'vars'}};
    exists $vars{$key};
}

sub CLEAR
{
    @{shift->{'vars'}} = ();
}

sub DELETE
{
    my ($self, $key) = @_;
    my @vars = @{$self->{'vars'}};
    my (@new, @del);
    for (my $i = 0; $i < @vars ; $i++ ) {
	if ( $vars[$i] eq $key ) {
	    $i++;
	    push @del, $vars[$i];
	    next;
	}

	push @new, $vars[$i++], $vars[$i];
    }
    $self->{'vars'} = \@new;
    Bedrock::Array->new(@del);
}

1;

#
# Name of Release: $Name$
# $Log$
# Revision 1.6  2010/11/29 15:57:51  rlauer
# - change openbedrock.org to openbedrock.net
#
# Revision 1.5  2010/10/30 22:10:36  rlauer
# - add this back into Bedrock for compatibility, even though all hashes are now
#   ordered hashes
#
# Revision 1.3  2008/12/03 14:01:18  alans
# We now use a hard-coded value for module $VERSION rather than a munged
# version of the expansion of the CVS 'Revision' keyword; the module API
# version number is orthogonal to the identifyer in the source control
# system.
#
# This change makes it safe to import the Bedrock codebase into another
# source repository (even CVS!) without breaking the code. We hit this
# issue when we first released the libbedrock-perl .deb package, for which
# we imported the release tarball sources into the 'bedrock-deb' CVS project.
#
# Revision 1.2  2001/02/15 14:17:25  sridhar
# Oops! forgot to change the name of the module after renaming it
# OrderedObject.
#
# Revision 1.1  2001/02/15 13:43:03  sridhar
# Moved List.pm to OrderedObject.pm
#
# Revision 1.3  2001/02/14 15:35:43  sridhar
# Added copyright and GPL notice
#
# Revision 1.2  2000/12/08 20:06:41  sridhar
# Takes an object or an array as an argument to the constructor and
# expands it to get key-value pairs
#
# Revision 1.1  2000/12/01 15:10:04  sridhar
# List -- BLM implementing the concept of an object with ordered
# properties. Stores properties in the order they were set.
#
#

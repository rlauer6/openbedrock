#!/usr/local/bin/perl -w

# ident "@(#) $Header$"
# ident "@(#) $Name$"

package BLM::Mail;

use strict;

BEGIN
{
    use Exporter ();
    use vars	qw ($VERSION @ISA);
    $VERSION	= do { my @r = (q$Revision$ =~ /\d+/g); sprintf "%d."."%02d" x $#r, @r };
}

use TagX::Log 1.01;
use SIS::Hash 1.01;
use Net::SMTP;    
@ISA = qw(SIS::Hash);

sub TIEHASH
{
    my $class = shift;
    my $server = shift;

    my $self = bless {}, $class;
    $self->{'smtp_server'} = $server;
    $self->{'content-type'} = "text/plain";
    $self->{'encoding'} = "7bit";
    $self;
}

sub sendmail
{
    my $self = shift;

    die "TO ERROR" unless $self->{'to'};
    die "NO MESSAGE" unless $self->{'message'};

    my $smtp = Net::SMTP->new($self->{'smtp_server'});
    die "SMTP CONNECT ERROR" unless $smtp;

    die "FROM ERROR" unless $self->{'from'};

    $smtp->mail($self->{'from'});
    my @email = ($self->{'to'});
    push @email, split /;/, $self->{'cc'};
 
    foreach my $to (@email) { 
	if (!$smtp->to($to)) {
	    die "SEND ERROR";
	}
    }

    $smtp->data();
    $smtp->datasend("To: $self->{'to'}\n");
    $smtp->datasend("From: $self->{'from'}\n");
    $smtp->datasend("CC: $self->{'cc'}\n") if $self->{'cc'};
    $smtp->datasend("Subject: $self->{'subject'}\n");
    $smtp->datasend("Content-type: $self->{'content-type'}\n");
    $smtp->datasend("Content-Transfer-Encoding: $self->{'encoding'}\n\n");
    $smtp->datasend($self->{'message'});
    $smtp->dataend();
    $smtp->quit;

# reset vars
    $self->{'to'} = undef;
    $self->{'from'} = undef;
    $self->{'message'} = undef;
    $self->{'subject'} = undef;
    $self->{'cc'} = undef;
}


1;

#
# Name of Release: $Name$
# $Log$
# Revision 1.1  2000/09/18 18:30:13  sridhar
# Moving some general purpose BLMs from Perl/BLM to Perl/Bedrock/BLM
#
# Revision 1.1  2000/06/22 14:30:53  rlauer
# Initial checkin.
#
#

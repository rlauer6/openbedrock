#!/usr/local/bin/perl -w


package BLM::SIMPLEFTP;

use strict;

BEGIN
{
    use Exporter ();
    use vars	qw ($VERSION @ISA);
    $VERSION	= do { my @r = (q$Revision$ =~ /\d+/g); sprintf "%d."."%02d" x $#r, @r };
}

use TagX::Log 1.01;
use SIS::Hash 1.01;
use Net::FTP;    
@ISA = qw(SIS::Hash);

sub TIEHASH
{
    my $class = shift;
    my $host = shift;

    my $self = bless {}, $class;
    $self->{'host'} = $host;

    my $ftp = Net::FTP->new($host);

    die $@ unless defined $ftp;

    $self->{'ftp'} = $ftp;

    $self;
}

sub login
{
    my $self = shift;
    my ($user, $pass, $acct) = @_;

    my $ftp = $self->{'ftp'};

    die $@ unless defined $ftp->login($user, $pass, $acct);
}

sub ascii
{
    my ($self, $args) = @_;

    my $ftp = $self->{'ftp'};

    my $last = $ftp->ascii($args);
    die $@ unless defined $last;

    $last;
}

sub binary
{
    my ($self, $args) = @_;

    my $ftp = $self->{'ftp'};

    my $last = $ftp->binary($args);
    die $@ if !$last;

    $last;
}

sub cwd
{
    my ($self, $args) = @_;

    my $ftp = $self->{'ftp'};

    my $last = $ftp->cwd($args);
    die $@ if !$last;

    $last;
}

sub pwd
{
    my $self = shift;

    my $ftp = $self->{'ftp'};

    my $pwd = $ftp->pwd();

    die $@ unless defined $pwd;

    $pwd;
}

sub ls
{
    my ($self, $dir) = @_;

    my $ftp = $self->{'ftp'};

    return SIS::Array->new(@{$ftp->ls($dir)});
}

sub quit
{
    my $self = shift;

    my $ftp = $self->{'ftp'};

    $ftp->quit;

    $self->{'ftp'} = undef;
}

sub stor 
{
    my $self = shift;
    my $file = shift;

    my $ftp = $self->{'ftp'};

    my $conn = $ftp->stor($file);

    die $@ unless defined $conn;

    $self->{'conn'} = $conn;
}

sub retr
{
    my $self = shift;
    my $file = shift;

    my $ftp = $self->{'ftp'};

    my $conn = $ftp->retr($file);

    die $@ unless defined $conn;

    $self->{'conn'} = $conn;
}

sub read 
{
    my $self = shift;
    my ($size, $timeout) = @_;
    
    my $ftp = $self->{'ftp'};
    my $conn = $self->{'conn'};

    my $buffer;

    die $@ unless defined $conn->read($buffer, $size, $timeout);

    $buffer;
}

sub write 
{
    my $self = shift;
    my ($buffer, $timeout) = @_;
    
    my $conn = $self->{'conn'};

    die $@ unless defined $conn->write($buffer, length($buffer), $timeout);

    $buffer;
}

sub close
{
    my $self = shift;
    my $conn = $self->{'conn'};

    $conn->close;
    $self->{'conn'} = undef;
}

sub put
{
    my $self = shift;

    my $ftp = $self->{'ftp'};

    $ftp->put(@_);
}

sub get
{
    my $self = shift;

    my $ftp = $self->{'ftp'};

    die unless defined $ftp->get(@_);
}

1;


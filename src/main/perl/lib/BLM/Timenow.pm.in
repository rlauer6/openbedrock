#!/usr/local/bin/perl -w

# ident "@(#) $Header$"
# ident "@(#)        $Name$"

#
#    This file is a part of Bedrock, a server-side web scripting tool.
#    Check out http://www.openbedrock.org
#    Copyright (C) 2001, Charles Jones, LLC.
#
#    This program is free software; you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation; either version 2 of the License, or
#    any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program; if not, write to the Free Software
#    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
#

package BLM::Timenow;

use strict;

BEGIN
{
    use Exporter ();
    use vars	qw ($VERSION @ISA);
    $VERSION	= do { my @r = (q$Revision$ =~ /\d+/g); sprintf "%d."."%02d" x $#r, @r };
}

use TagX::Log 1.01;
use SIS::Hash 1.01;
@ISA = qw(SIS::Hash);

my @__mon = qw (jan feb mar apr may jun jul aug sep oct nov dec);
my @__day = qw (sunday monday tuesday wednesday thursday friday saturday);
my @__dy  = qw (sun mon tue wed thu fri sat);

#
# Local time functions
#
sub SS		{sprintf "%02d", $_[0]}
sub MI		{sprintf "%02d", $_[1]}
sub HH24	{sprintf "%02d", $_[2]}
sub HH		{my $hour = $_[2]; sprintf "%02d", $hour > 12 ? $hour - 12 : $hour}
sub D		{$_[6]}
sub DD		{sprintf "%02d", $_[3]}
sub DDD		{sprintf "%03d", $_[7] + 1}
sub DAY		{uc($__day[$_[6]])}
sub day		{lc($__day[$_[6]])}
sub Day		{ucfirst($__day[$_[6]])}
sub DY		{uc($__dy[$_[6]])}
sub dy		{lc($__dy[$_[6]])}
sub Dy		{ucfirst($__dy[$_[6]])}
sub YY		{my $year = $_[5]; sprintf "%02d", $year >= 100 ? $year - 100 : $year}
sub YYYY	{sprintf "%04d", $_[5] + 1900}
sub MM		{sprintf "%02d", $_[4] + 1}
sub MON		{uc($__mon[$_[4]])}
sub mon		{lc($__mon[$_[4]])}
sub Mon		{ucfirst($__mon[$_[4]])}
sub ctime	{scalar( localtime( $_[-1] ) )}

#
# GM time functions
#
sub rfc1123
{
    my ( $sec, $min, $hour, $mday, $mon, $year, $wday, $yday, $isdst, $time) = @_;
    sprintf( "%s, %02d %s %d %02d:%02d:%02d GMT",
	     ucfirst( $__dy[$wday] ),
	     $mday,
	     ucfirst( $__mon[$mon] ),
	     $year + 1900,
	     $hour, $min, $sec);
}

sub rfc850
{
    my ( $sec, $min, $hour, $mday, $mon, $year, $wday, $yday, $isdst, $time) = @_;
    sprintf( "%s, %02d-%s-%d %02d:%02d:%02d GMT",
	     ucfirst( $__day[$wday] ),
	     $mday,
	     ucfirst( $__mon[$mon] ),
	     $year + 1900,
	     $hour, $min, $sec);
}

sub FETCH
{
    my $self = shift;
    my $key = shift;

    my %localtime = ('SS'	=> \&SS,
		     'MI'	=> \&MI,
		     'HH24'	=> \&HH24,
		     'HH12'	=> \&HH,
		     'HH'	=> \&HH,
		     'D'	=> \&D,
		     'DD'	=> \&DD,
		     'DDD'	=> \&DDD,
		     'DAY'	=> \&DAY,
		     'day'	=> \&day,
		     'Day'	=> \&Day,
		     'DY'	=> \&DY,
		     'dy'	=> \&dy,
		     'Dy'	=> \&Dy,
		     'MM'	=> \&MM,
		     'MON'	=> \&MON,
		     'mon'	=> \&mon,
		     'Mon'	=> \&Mon,
		     'YY'	=> \&YY,
		     'YYYY'	=> \&YYYY,
		     'ctime'	=> \&ctime);

    my %gmtime = ('RFC1123'	=> \&rfc1123,
		  'RFC850'	=> \&rfc850);

    if ( exists $localtime{$key} ) { return $localtime{$key}->(localtime, time); }
    elsif ( exists $gmtime{$key} ) { return $gmtime{$key}->(gmtime, time); }
    undef;
}

1;

#
# Name of Release: $Name$
# $Log$
# Revision 1.2  2001/02/14 15:35:44  sridhar
# Added copyright and GPL notice
#
# Revision 1.1  2000/09/18 18:30:14  sridhar
# Moving some general purpose BLMs from Perl/BLM to Perl/Bedrock/BLM
#
# Revision 1.1  2000/06/06 20:47:57  sridhar
# BLM for current time -- moved from Bedrock/Modules directory
#
# Revision 1.2  2000/05/17 19:55:43  sridhar
# Added ctime.
#
# Revision 1.1  2000/05/17 14:29:42  sridhar
# Adding Loadable module TimeNow -- support for current date and time in
# Bedrock pages
#
#


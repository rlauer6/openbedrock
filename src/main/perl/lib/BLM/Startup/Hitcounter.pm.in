#!/usr/local/bin/perl -w

# ident "@(#) $Header$"
# ident "@(#)        $Name$"

package BLM::Startup::Hitcounter;

use strict;

BEGIN
{
    use Exporter ();
    use vars	qw ($VERSION @ISA);
    $VERSION	= do { my @r = (q$Revision$ =~ /\d+/g); sprintf "%d."."%02d" x $#r, @r };
}

use POSIX;
use SDBM_File;
use SIS::Hash;
@ISA = qw(SIS::Hash);

sub TIEHASH
{
    my $class = shift;
    my $ctx = shift;

    my $self = bless SIS::Hash->new, $class;
    $self->{'me'} = $ENV{'SCRIPT_NAME'} || $ENV{'REQUEST_URI'} || $ENV{'SCRIPT_URL'};
    $self->{'config'} = $ctx->getConfigValue('HIT_COUNTER');
    $self;
}

sub FETCH
{
    my $self = shift;
    my $key = shift;
    return $self->{$key} if exists $self->{$key};
    if ( $key eq 'count' ) {
	# First time thru'
	# 1. Get the hitcount database path
	my $db = $self->{'config'}->{'db_path'};
	return unless $db;
	warn "db_path is <$db>";
	my %counts;
	tie %counts, 'SDBM_File', $db, O_CREAT|O_RDWR, 0640;
	$counts{$self->{'me'}}++;
	return $self->{'count'} = $counts{$self->{'me'}};
    }
    undef;
}

1;

#
# Name of Release: $Name$
# $Log$
# Revision 1.1  2000/10/12 15:22:48  sridhar
# Bedrock can now boast of hit counter capability.
#
#

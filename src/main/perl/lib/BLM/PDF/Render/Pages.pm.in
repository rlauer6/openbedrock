# ident "@(#) $Header$"
# ident "@(#)        $Name$"

#
#    This file is a part of Bedrock, a server-side web scripting tool.
#    Check out http://www.openbedrock.org
#    Copyright (C) 2001, Charles Jones, LLC.
#
#    This program is free software; you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation; either version 2 of the License, or
#    any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program; if not, write to the Free Software
#    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
#

package BLM::PDF::Render::Pages;

use BLM::PDF::Log;
use BLM::PDF::Document::Document;
use BLM::PDF::Render::Array;
use BLM::PDF::Render::Page;
use BLM::PDF::Render::PDFObject;

@ISA = qw(BLM::PDF::Render::PDFObject);
use strict;

sub new
{
   my $class = shift;
   my ($registry, $pages) = @_;

   my $this = 
     { 'registry'	=> $registry,
       'pages'		=> $pages,
       'pagecount'	=> 0,
       'kids'		=> new BLM::PDF::Render::Array,
     };

   bless $this, $class;
} # sub new

sub addKid  
{ 
   ${_[0]}->{'kids'}->insertIndirectObject(${_[1]}); 
   ${_[0]}->{'pagecount'}++;
} # sub addKid

sub render
{
   my $this = shift;
   my $pages = $$this{'pages'};
   my $registry = $$this{'registry'};
   my $root = BLM::PDF::Render::PDFObject->new($registry);
   $registry->setObject('page_tree', $root);
   $root->insertName('Type', 'Pages');
   $registry->addObject($root);
   $this->_buildPageLevelOne($root, $pages);
   my $catalog = $registry->getObject('document_catalog');
   $catalog->insertIndirectObject('Pages', $root);
} # render

sub _buildPageLevelOne
{
   my ($this, $page_root, $pages) = @_;
   my $registry = $$this{'registry'};
   my $kids = $$this{'kids'};

   foreach my $page (@$pages)
   {
      $page->close();
      my $obj = BLM::PDF::Render::Page->new($this, $registry, $page, $page_root,
					    ++$this->{'pagecount'});
      $kids->insertIndirectObject($obj);
      $page->setPeer($obj);
      $obj->validate();
      $this->_buildPageLevel($obj, $kids, [$page->getPages()]);
      $registry->addObject($obj);
   }

   $page_root->insertArray('Kids', $kids);
   $page_root->insertNumber('Count', $this->{'pagecount'});
   my $catalog = $registry->getObject('document_catalog');
   $catalog->insertIndirectObject('Pages', $page_root);
} # sub _buildPageLevel

sub _buildPageLevel
{
   my ($this, $parent, $kids, $pages) = @_;
   my $registry = $$this{'registry'};

   foreach my $page (@$pages)
   {
      $page->close();
      my $obj = BLM::PDF::Render::Page->new($this, $registry, $page, $parent,
					    ++$this->{'pagecount'});
      $kids->insertIndirectObject($obj);
      $page->setPeer($obj);
      $obj->validate();
      $this->_buildPageLevel($obj, $kids, [$page->getPages()]);
      $registry->addObject($obj);
   }
} # sub _buildPageLevel

1;

#
# Name of Release: $Name$
# $Log$
# Revision 1.7  2001/02/14 15:35:45  sridhar
# Added copyright and GPL notice
#
# Revision 1.6  2001/02/14 15:24:46  sridhar
# added CVS headers and trailers
#
#

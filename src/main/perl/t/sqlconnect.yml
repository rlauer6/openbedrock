---
name: <sqlconnect>
test: |
  <try>
    <sqlconnect:dbi --verbose --username=root dbi:mysql:bedrock:10.1.4.191 >
    <iif $dbi success 'no dbi'>
  <catch>
    <var $@>
  </try>
result: /success/s
op: like
---
name: <sqlconnect --dsn="bedrock">
test: |
  <try>
    <sqlconnect:dbi --verbose --dsn="bedrock" >
    <iif $dbi success 'no dbi'>
  <catch>
    <var $@>
  </try>
result: /success/s
op: like
---
name: <sqlconnect> dsn, but no user
test: |
  <try>
    <sqlconnect:dbi --verbose dbi:mysql:bedrock:10.1.4.191 >
    <iif $dbi success 'no dbi'>
  <catch>
    <var $@>
  </try>
result: '/sqlconnect: no user found/'
op: like
---
name: <sqlconnect> no dsn && no user
test: |
  <try>
    <sqlconnect:dbi --verbose  >
    <iif $dbi success 'no dbi'>
  <catch>
    <var $@>
  </try>
result: '/sqlconnect: no dsn found/'
op: like
---
name: <sqlconnect> dbi stored?
test: |
  <try>
    <sqlconnect:dbi --verbose --username=root dbi:mysql:bedrock:10.1.4.191 >
    <var $dbi.ping()>
  <catch>
    <var $@>
  </try>
result: '/^\s*1\s*/s'
op: like
---
name: <sqlconnect> dbi valid
test: |
  <try>
    <sqlconnect:dbi --username=root dbi:mysql:bedrock:10.1.4.191 >
    <trace --output $dbi>
    <sqlselect --verbose --db="dbi" "select * from campaigns">
      <var $id>,<var $name>
    </sqlselect>
  <catch>
    <var $@>
  </try>
result: '/1,subscription/'
op: like

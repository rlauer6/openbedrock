--- 
name: 1 - simple truthiness - true
comment: Backward compatibility - simple boolean value
param:
  foo: 1
result: yes
test: <iif $foo yes no>
--- 
name: 2 - simple truthiness - false
param:
  foo: 0
result: no
test: <iif $foo yes no>
--- 
name: 3 - simple truthiness - undefined is false
param:
  bar: 1
result: no
test: <iif $foo yes no>
--- 
name: 4 - simple truthiness - empty string is false
param:
  foo: ""
result: no
test: <iif $foo yes no>
--- 
name: 5 - simple truthiness - non-empty string is true
param:
  foo: "hello"
result: yes
test: <iif $foo yes no>
--- 
name: 6 - unary --not operator
param:
  foo: 0
result: yes
test: <iif (--not $foo) yes no>
--- 
name: 7 - unary --defined operator - defined
param:
  foo: 0
result: yes
test: <iif (--defined $foo) yes no>
--- 
name: 8 - unary --defined operator - undefined
param:
  bar: 1
result: no
test: <iif (--defined $foo) yes no>
--- 
name: 9 - unary --scalar operator - true
param:
  foo: hello
result: yes
test: <iif (--scalar $foo) yes no>
--- 
name: 10 - unary --array operator - true
param:
  foo: [1,2,3]
result: yes
test: <iif (--array $foo) yes no>
--- 
name: 11 - unary --array operator - false on scalar
param:
  foo: hello
result: no
test: <iif (--array $foo) yes no>
--- 
name: 12 - unary --hash operator - true
param:
  foo: {a: 1, b: 2}
result: yes
test: <iif (--hash $foo) yes no>
--- 
name: 13 - binary --eq operator - strings equal
param:
  status: active
result: ✓
test: <iif ($status --eq 'active') ✓ ✗>
--- 
name: 14 - binary --eq operator - strings not equal
param:
  status: inactive
result: ✗
test: <iif $status --eq 'active' ✓ ✗>
--- 
name: 15 - binary --eq operator - numbers equal
param:
  count: 5
result: equal
test: <iif $count --eq 5 equal notequal>
--- 
name: 16 - binary --ne operator - not equal
param:
  status: active
result: different
test: <iif $status --ne 'inactive' different same>
--- 
name: 17 - binary --gt operator - greater than true
param:
  count: 10
result: many
test: <iif $count --gt 5 many few>
--- 
name: 18 - binary --gt operator - greater than false
param:
  count: 3
result: few
test: <iif $count --gt 5 many few>
--- 
name: 19 - binary --ge operator - greater or equal
param:
  count: 5
result: pass
test: <iif $count --ge 5 pass fail>
--- 
name: 20 - binary --lt operator - less than true
param:
  count: 3
result: low
test: <iif $count --lt 5 low high>
--- 
name: 21 - binary --le operator - less or equal
param:
  count: 5
result: ok
test: <iif $count --le 5 ok toohigh>
--- 
name: 22 - binary --and operator - both true
param:
  foo: 1
  bar: 1
result: both
test: <iif $foo --and $bar both notboth>
--- 
name: 23 - binary --and operator - first false
param:
  foo: 0
  bar: 1
result: notboth
test: <iif $foo --and $bar both notboth>
--- 
name: 24 - binary --or operator - at least one true
param:
  foo: 0
  bar: 1
result: atleastone
test: <iif $foo --or $bar atleastone neither>
--- 
name: 25 - binary --or operator - both false
param:
  foo: 0
  bar: 0
result: neither
test: <iif $foo --or $bar atleastone neither>
--- 
name: 26 - binary --re operator - regex match
param:
  email: user@gmail.com
result: Gmail
test: <iif $email --re '@gmail\.com$' Gmail Other>
--- 
name: 27 - binary --re operator - regex no match
param:
  email: user@yahoo.com
result: Other
test: <iif $email --re '@gmail\.com$' Gmail Other>
--- 
name: 28 - binary --re operator - case insensitive
param:
  text: HELLO
result: matched
test: <iif $text --re '/hello/i' matched nomatch>
--- 
name: 29 - binary --re operator - capture groups available
comment: Tests that regex captures work in iif context
param:
  foo: foobar
result: matched
test: <iif $foo --re 'foo' matched nomatch>
--- 
name: 30 - string comparison with --gt
comment: Alpha comparison for non-numeric strings
param:
  name: charlie
result: later
test: <iif $name --gt 'bravo' later earlier>
--- 
name: 31 - numeric vs string comparison
comment: Numbers are compared numerically
param:
  value: 100
result: bigger
test: <iif $value --gt 20 bigger smaller>
--- 
name: 32 - whitespace in output - with trim
comment: Tests trim feature removes leading/trailing space
param:
  foo: 1
result: yes
trim: yes
chomp: all
test: |
  <iif $foo 
       yes 
       no>
--- 
name: 33 - multiline template - with chomp
comment: Tests chomp removes blank lines
param:
  status: active
result: Active User
chomp: all
trim: yes
test: |

  <iif $status --eq 'active' 'Active User' 'Inactive User'>

--- 
name: 34 - inline in HTML attribute
comment: Real-world use case - checkbox checked state
param:
  checked: 1
result: <input type="checkbox" checked>
trim: yes
chomp: all
test: <input type="checkbox" <iif $checked checked ''>>
--- 
name: 35 - inline in HTML class
param:
  active: 1
result: <div class="active">
trim: yes
chomp: all
test: <div <iif $active 'class="active"' 'class="inactive"'>>
--- 
name: 36 - complex expression - parentheses
comment: Tests nested/complex boolean expressions
param:
  user:
    admin: 1
    active: 1
result: Admin
test: <iif ($user.admin --and $user.active) Admin User>
--- 
name: 37 - complex expression - multiple conditions
param:
  count: 15
  status: active
result: valid
chomp: all
test: <iif (($count --gt 10) --and ($status --eq 'active')) valid invalid>
--- 
name: 38 - null/undefined handling
comment: Undefined variable treated as false
param:
  something: else
result: undefined
test: <iif $notdefined defined undefined>
--- 
name: 39 - zero is falsy
param:
  count: 0
result: zero
test: <iif $count nonzero zero>
--- 
name: 40 - empty string is falsy
param:
  text: ""
result: empty
test: <iif $text nonempty empty>
--- 
name: 41 - array with elements is truthy
param:
  items: [1, 2, 3]
result: hasitems
test: <iif $items.length() hasitems noitems>
--- 
name: 42 - empty array is falsy
param:
  items: []
result: noitems
test: <iif $items.length() hasitems noitems>
--- 
name: 43 - hash with keys is truthy
param:
  obj: {key: value}
result: hasobject
test: <iif $obj.keys() hasobject noobject>
--- 
name: 44 - empty hash is falsy
param:
  obj: {}
result: noobject
test: <iif $obj.empty() noobject hasobject>
--- 
name: 45 - chained with null tag
comment: Common pattern - set variable then test
param: {}
result: found
test: |
  <null:foo "bar">
  <iif $foo --eq 'bar' found notfound>
trim: yes
chomp: all
---
name: 47 - with foreach context
comment: Tests iif works inside loop
param:
  users:
    - {name: alice, active: 1}
    - {name: bob, active: 0}
result:
  - "alice: ✓"
  - "bob: ✗"
op: any
trim: yes
chomp: all
test: |
  <foreach $users -/>
    <var $_.name>: <iif $_.active ✓ ✗>
  </foreach>
--- 
name: 48 - very long expression
comment: Tests expression can span multiple lines
param:
  user:
    role: admin
    verified: 1
    active: 1
result: authorized
trim: yes
chomp: all
test: |
  <iif (($user.role --eq 'admin') 
       --and ($user.verified 
       --and $user.active) )
       authorized 
       unauthorized>
--- 
name: 49 - quoted strings with spaces
param:
  message: "hello world"
result: match
test: <iif $message --eq 'hello world' match nomatch>
--- 
name: 50 - special characters in output
param:
  foo: 1
result: "→ yes ←"
test: <iif $foo '→ yes ←' '→ no ←'>
--- 
name: 51 - numeric zero vs string zero
param:
  num: 0
result: iszerobut
test: <iif $num --eq 0 iszerobut different>
--- 
name: 52 - comparing to empty string
param:
  text: ""
result: isempty
test: <iif $text --eq '' isempty notempty>
--- 
name: 53 - --ref operator - checking type
param:
  arr: [1,2,3]
result: isref
test: <iif --ref $arr isref notref>
--- 
name: 54 - --reftype operator
param:
  obj: {a: 1}
result: ishash
test: <iif $obj --reftype 'HASH' ishash nothash>
--- 
name: 55 - error - missing variable
comment: Undefined var is just false, not an error
param: {}
result: no
test: <iif $undefined yes no>
--- 
name: 56 - with sink to capture
comment: Tests iif output can be captured
param:
  status: active
result: Active
trim: yes
chomp: all
test: |
  <sink:output>
    <iif $status --eq 'active' Active Inactive>
  </sink>
  <var $output>
--- 
name: 57 - boolean expressions - complex and/or
param:
  a: 1
  b: 0
  c: 1
result: yes
test: <iif ($a --and ($b --or $c)) yes no>
--- 
name: 58 - string contains with regex
param:
  path: /admin/users
result: admin
test: <iif $path --re '/admin/' admin public>
--- 
name: 59 - case sensitive comparison
param:
  text: Hello
result: different
test: <iif $text --eq 'hello' same different>
--- 
name: 60 - number as string comparison
param:
  val: "123"
result: numeric
test: <iif $val --eq 123 numeric string>
--- 
name: 61 - performance - simple case
comment: Ensure simple truthiness still fast
param:
  flag: 1
result: on
test: <iif $flag on off>


#
# Unit tests for <var> (Write) and <null> (Read) Caching
# Corrected: <var> is a NoBody tag.
#

---
name: Var Cache Write (Output and Store)
default_env:
  BEDROCK_CACHE_ENGINE: Shareable
  CONFIG_PATH: t/conf
test: |
  <var --cache="vn_test_key_01" "Stored Value">
result: |
  Stored Value
---
name: Null Cache Read (Retrieve and Assign)
default_env:
  BEDROCK_CACHE_ENGINE: Shareable
  CONFIG_PATH: t/conf
test: |
  <null:retrieved --cache="vn_test_key_01">
  RETRIEVED: <var $retrieved>
result: RETRIEVED: Stored Value
trim: true
chomp: all
---
name: Var Cache TTL (Write with Expiry)
default_env:
  BEDROCK_CACHE_ENGINE: Shareable
  CONFIG_PATH: t/conf
test: |
  <var --cache="vn_ttl_key" --ttl="1" "Fleeting Data">
result: |
  Fleeting Data
---
name: Null Cache TTL (Read after Expiry)
default_env:
  BEDROCK_CACHE_ENGINE: Shareable
  CONFIG_PATH: t/conf
op: like
test: |
  <null --sleep=2>
  <null:gone --cache="vn_ttl_key">
  STATUS: <var --default="GONE" $gone>
result: /STATUS: GONE/
---
name: Integration (Cache JSON string -> Read as Object)
default_env:
  BEDROCK_CACHE_ENGINE: Shareable
  CONFIG_PATH: t/conf
test: |
  <var --cache="vn_json_key" '{"foo":"bar"}'>
  <null:my_obj --json --cache="vn_json_key">
  VALUE: <var $my_obj.foo>
trim: true
result: |
  {"foo":"bar"}
  
  VALUE: bar

# -*-text-*-

The 'bedrock' project is built using the GNU Autotools (Automake, Autoconf,
etc.)

This file contains the following sections:

    * Building from a Source Tarball
    * Building from CVS

Building from a Source Tarball
==============================

If you simply want to build the 'bedrock' project (as opposed to hacking on
the codebase), the easiest thing to do is obtain a source distribution tarball
of the version of the project you wish to build.

FIXME: document where to get a source distribution tarball

This relieves you of having access to specific versions of the GNU
Autotools, etc.

    $ cd /usr/local/src
    .../src$ wget -nd http://some.host.signatureinfo.com/some/path/bedrock-1.6.6.tar.gz
    .../src$ ls | grep bedrock
    bedrock-1.6.6.tar.gz
    .../src$
    .../src$ gzip -dc bedrock-1.6.6.gz | tar xf -
    .../src$ cd bedrock-1.6.6
    .../src/bedrock-1.6.6$ ./configure --prefix=/path/to/whatever
    .../src/bedrock-1.6.6$ make
    .../src/bedrock-1.6.6$ make check
    .../src/bedrock-1.6.6$ make install



Building from CVS
=================

All developers working on the 'bedrock' project need to be using the same
versions of the Autotools programs in the toolchain. Currently (as of
2008-02), those versions are:

    automake 1.9.6
    autoconf 2.61

You can determine the versions in your PATH by invoking the respective
tools with the '--version' option:

    $ autoconf --version
    autoconf (GNU Autoconf) 2.61
    Copyright (C) 2006 Free Software Foundation, Inc.
    This is free software.  You may redistribute copies of it under the terms of
    the GNU General Public License <http://www.gnu.org/licenses/gpl.html>.
    There is NO WARRANTY, to the extent permitted by law.

    Written by David J. MacKenzie and Akim Demaille.


    $ autoreconf --version
    autoreconf (GNU Autoconf) 2.61
    Copyright (C) 2006 Free Software Foundation, Inc.
    This is free software.  You may redistribute copies of it under the terms of
    the GNU General Public License <http://www.gnu.org/licenses/gpl.html>.
    There is NO WARRANTY, to the extent permitted by law.

    Written by David J. MacKenzie and Akim Demaille.


Check the bedrock source out of CVS:

    $ cvs co bedrock
    $ cd bedrock

You'll notice that there is a 'configure' script in the root directory, as
well as 'Makefile.in' files scattered throughout the tree. These files are all
generated by the GNU Autotools, and are checked into CVS to allow (in the
future) developers to configure the project upon CVS checkout.

Upon a fresh checkout, you should be able to just run 'configure'. However, if
you have an already checked-out source tree that you run some variation of
'cvs update' on, then simply rerunning 'configure' will not work because CVS
will have modified the timestamps of updated files to have the current time.

In order to allow developers to configure the project directly after a CVS
update (without requiring access to the GNU Autotools), we need a script to
touch(1) various files in the correct order (that is, in the same order that
the GNU Autotools generated them in the first place). As of 2008-02-28, such a
script does not exist for the 'bedrock' project, so developers must have the
correct versions of the GNU Autotools available.

Pre-configuration: The 'bootstrap' script

    $ pwd
    .../bedrock
    $ ./bootstrap

The 'bootstrap' script simply invokes the GNU Autotools in the correct order
in such a way that it assumes all timestamps are invalid. This has the effect
of regenerating the autogenerated files with meaningful timestamps. After
doing a 'cvs update', if the 'bootstrap' script is not run prior to running
'configure', you'll get strange, broken behavior from the 'configure' process
due to the timestamp issue mentioned above.

After you've run the 'bootstrap' script, you are ready to configure the
project for your host:

    $ ./configure --prefix=/path/to/wherever
    $ make
    $ make check

You probably do not want to run 'make install' from your CVS working
directory. If you want to install ("for real") your newly hacked version of
the 'bedrock' project, then create a distribution tarball and install using
that:

    $ make distcheck
    $ ls | grep bedrock
    bedrock-1.6.6.tar.gz

Note: It is not acceptable to simply invoke:

    $ make dist

for a release of the 'bedrock'. If the build does not pass the 'distcheck'
verifications, the package is broken.

For new releases, the version of the project must be changed in the
'configure.ac' file, and the 'bootstrap' script re-run to regenerate the GNU
Autotools generated files (such as the 'configure' program and all
'Makefile.in' files).

After a release is made, the version number should be incremented with the
constant '-snapshot' appended to it. Again, the 'boostrap' script should be
re-run to regenerate the GNU Autotools generated files.

For example, during the development of the code that will be released as
version 1.6.7, the version number specified in 'configure.ac' should be:

    1.6.7-snapshot

This eliminates the possibility of producing artifacts labeled just '1.6.7'
which are not the final release.

When it comes time to do the release, the version number in 'configure.ac'
should be changed to remove the '-snapshot' suffix, and the 'bootstrap'
script rerun.

    1.6.7

The GNU Autotools generated files should be checked into CVS, and the release
should be tagged. After the final release is tagged, the version number in
'configure.ac' should be bumped up for the next development cycle, and the
'bootstrap' script re-run.

    1.6.8-snapshot
